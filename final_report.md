# Computer Vision Final Project

## 简介

本次大作业的内容是瓶盖检测，分辨出桌面上的瓶盖是正面、侧面还是反面。

达成的大作业要求：

* 基本要求：全部完成
  * 检测出正面的瓶盖
  * 检测出侧面的瓶盖
  * 检测出反面的瓶盖
  * 在简单背景上运行
  * UI
* 额外要求：
  * 使用颜色不一样的瓶盖
  * 使用不同形状的瓶盖

正确识别率达95%以上。

## 部署

用anaconda可以直接利用所给的env.yaml创建虚拟环境。

```bash
# env.yaml的name一栏里面存着虚拟环境的名字。若是助教电脑上名称重复了可以换一个名字。
conda env create -f env.yaml
# 激活创建的虚拟环境，cvProject为虚拟环境的名称。
conda activate cvProject

python demogui.py
```



## 基本算法及原理

对于一个输入的图片，首先要检测出哪些是瓶盖，然后再对于瓶盖的状态（正面、侧面、反面）进行识别。

### 瓶盖检测（提取）

瓶盖在图像中体现为一段连通区域。通过识别图像的连通区域，并进行过滤等操作去除噪声和杂物的影响，可以提取出瓶盖的位置坐标，并用瓶盖对应的矩形区域的对角线两点坐标来表示一个瓶盖。

#### 核心算法

本次实验先后使用了BFS和Two Pass两种算法来做瓶盖的检测，并比较了两种算法的性能。

* BFS算法：

  对图像上每一个点进行遍历，找出每一个点的邻接的连通点，并加入该点的连通组。这些连通组，每一个组代表了一个分立的连通区域，即一个组代表了一个瓶盖（的边缘)。这样就可以把瓶盖检测出来。

* Two Pass算法：

  上课老师讲过的算法，这里就简单描述大意。

  第一次遍历，需要遍历图片上的每一个点，并对有色区域打标签，并对冲突（即和同一个点邻接的不同标签的点）的不同标签点加入一个数组。

  第二遍遍历，将该数组里面所有冲突的点都列为同一标签。这样，具有相同标签的点即为连通区域。

以上为瓶盖检测的核心算法。

#### 误差消除及过滤

除核心算法之外，需要用一些附加的算法来做误差消除及过滤。

* 前置处理：首先将图像灰度化，并进行滤波等一系列操作消除噪声，并进行边缘检测。图像上剩下了瓶盖的边缘点（以及瓶盖的花纹的边缘点)

* 消除非瓶盖杂物对检测的影响（如图上的毛发）

  杂物（如毛发）占据的像素点很少。因此同样设置一个阈值，若是一个连通区域包含的像素点个数低于这个阈值，便认为这个连通区域不是瓶盖。

* 消除边缘检测对连通图检测的误差：

  边缘检测得到的同一个瓶盖的边缘，可能由于图像拍摄时光照等因素的影响并不连通。为了防止不连通的同一瓶盖边缘被认为是两个“瓶盖”，需要对上述的核心算法进行小修改

  * BFS

    在BFS搜索的时候，对每一个点不仅仅搜索其邻域的4或8个点，而是设置一个阈值，如15，那么对一个点则扫描其周围15 * 15范围内的所有点，并将这个范围认为是该点的“邻域”。这样就可以消除这样的误差

  * Two Pass

    原本设定两个点冲突需要两个不同标签的点出现在同一个点的邻域。在改进版里面，同样设置一个阈值，如15。那么简单来说，就是一个点的相邻15 * 15范围内的点都会被认为是该点的冲突点，在最后被打上同一标签。

通过以上算法，可以有效提取出一个图像中的瓶盖

#### 性能比较

经过测试，Two Pass的性能比BFS要更好。

### 瓶盖状态识别

将上面经过处理的图像（即标识了瓶盖位置的图像）提取出来，通过人工分类的方式，分成正面（front），侧面（side）和反面（back）三类，并通过机器学习的方式进行训练生成模型。最终能够做到，输入瓶盖的图片（由之前的算法裁剪好），再输入模型输出判断结果。

TODO: